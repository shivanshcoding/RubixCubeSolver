<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Cube Input - CubeMasterAI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base-theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/ai_input.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header-footer.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    <script>
        // OpenCV.js loading with fallback
        function loadOpenCV() {
            const opencvScript = document.createElement('script');
            opencvScript.setAttribute('async', '');
            opencvScript.setAttribute('src', "{{ url_for('static', filename='js/lib/opencv.js') }}");

            opencvScript.addEventListener('load', function () {
                console.log('OpenCV.js loaded successfully');
                const event = new Event('opencv-loaded');
                window.dispatchEvent(event);
            });

            opencvScript.addEventListener('error', function (e) {
                console.error('Failed to load OpenCV.js, will use fallback detection', e);
                document.getElementById('detection-tips').innerHTML += '<p class="warning"><i class="fas fa-exclamation-triangle"></i> OpenCV library could not be loaded. Using simplified color detection.</p>';
            });

            document.head.appendChild(opencvScript);
        }

        // Load OpenCV when DOM is ready
        document.addEventListener('DOMContentLoaded', loadOpenCV);
    </script>
</head>

<body>

    <!-- Background Elements -->
    <div class="background-grid"></div>
    <div class="background-gradient"></div>

    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-container">
                <div class="logo" id="site-logo">
                    <!-- Animated Rubik's Cube SVG logo -->
                    <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg"
                        class="cube-logo">
                        <g class="cube-face front">
                            <rect x="10" y="10" width="40" height="40" rx="4" fill="var(--accent-primary)"
                                filter="url(#glow)" />
                            <rect x="15" y="15" width="10" height="10" rx="1" fill="#ff3d00" class="cube-tile" />
                            <rect x="25" y="15" width="10" height="10" rx="1" fill="#ffd600" class="cube-tile" />
                            <rect x="35" y="15" width="10" height="10" rx="1" fill="#00c853" class="cube-tile" />
                            <rect x="15" y="25" width="10" height="10" rx="1" fill="#2962ff" class="cube-tile" />
                            <rect x="25" y="25" width="10" height="10" rx="1" fill="#ffffff" class="cube-tile" />
                            <rect x="35" y="25" width="10" height="10" rx="1" fill="#ffeb3b" class="cube-tile" />
                            <rect x="15" y="35" width="10" height="10" rx="1" fill="#ff6d00" class="cube-tile" />
                            <rect x="25" y="35" width="10" height="10" rx="1" fill="#d500f9" class="cube-tile" />
                            <rect x="35" y="35" width="10" height="10" rx="1" fill="#00bcd4" class="cube-tile" />
                        </g>
                        <defs>
                            <filter id="glow" x="0" y="0" width="60" height="60" filterUnits="userSpaceOnUse">
                                <feGaussianBlur stdDeviation="2" result="blur" />
                                <feFlood flood-color="var(--accent-primary)" flood-opacity="0.5" result="color" />
                                <feComposite in="color" in2="blur" operator="in" result="glow" />
                                <feMerge>
                                    <feMergeNode in="glow" />
                                    <feMergeNode in="SourceGraphic" />
                                </feMerge>
                            </filter>
                        </defs>
                    </svg>
                </div>
                <div class="brand-text">
                    <h1 class="brand-name">CubeMaster<span class="brand-accent">AI</span></h1>
                </div>
            </div>
            <nav class="main-nav">
                <ul class="nav-links">
                    <li><a href="/" class="nav-link">Home</a></li>
                    <li><a href="/#features" class="nav-link">Features</a></li>
                    <li><a href="#about" class="nav-link">About</a></li>
                    <li><a href="/#tech" class="nav-link">Technology</a></li>
                </ul>
            </nav>
            <div class="theme-control">
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark/light mode">
                    <span class="theme-icon" id="theme-icon">ðŸŒ™</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="ai-vision-content">
        <div class="ai-vision-hero">
            <h1 class="section-title">AI <span class="gradient-text">Vision</span> Detection</h1>
            <p class="section-subtitle">Use your camera to scan your Rubik's Cube for an instant solution</p>
        </div>

        <!-- Step Indicators -->
        <div class="step-indicators">
            <div class="step-indicator active" data-step="1">
                <div class="step-circle">1</div>
                <div class="step-label">Color Selection</div>
            </div>
            <div class="step-line"></div>
            <div class="step-indicator" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Face Detection</div>
            </div>
            <div class="step-line"></div>
            <div class="step-indicator" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Cube Review</div>
            </div>
        </div>

        <!-- Step 1: Color Selection -->
        <div class="step-content" data-step="1">
            <div class="step-container">
                <h2 class="step-title">Step 1: <span class="gradient-text">Color Selection</span></h2>
                <p class="method-subtitle">Choose the colors that match your cube</p>

                <div class="methodology-container">
                    <div id="ai-color-palette-section">
                        <form id="ai-color-palette-form">
                            <div class="color-palette-row">
                                <label>Up (U): <input type="color" id="ai-color-up" value="#ffffff"></label>
                                <label>Right (R): <input type="color" id="ai-color-right" value="#ff2222"></label>
                                <label>Front (F): <input type="color" id="ai-color-front" value="#17d016"></label>
                                <label>Down (D): <input type="color" id="ai-color-down" value="#ffe900"></label>
                                <label>Left (L): <input type="color" id="ai-color-left" value="#ff9900"></label>
                                <label>Back (B): <input type="color" id="ai-color-back" value="#1177ff"></label>
                            </div>
                        </form>
                    </div>
                    <div class="container-2" data-step="1">
                        <div class="instructions-section">
                            <ol class="instructions-list">
                                <li><b>Pick the 6 colors</b> that match your cube using the palette above. Assign each
                                    to a
                                    face (Up, Right, Front, Down, Left, Back).</li>
                                <li>Click <b>Continue</b> to proceed to face detection.</li>
                            </ol>
                            <button type="submit" class="cta-button primary" id="ai-continue-btn">Continue to Face
                                Detection</button>
                        </div>
                        <div class="cube-preview-container" data-step="1">
                            <div id="cube-3d-preview" class="cube-3d-preview" data-step="1"></div>
                            <h3>3D Cube Preview</h3>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Face Detection -->
        <div class="step-content" data-step="2" style="display: none;">
            <div class="step-container">
                <h2 class="step-title">Step 2: <span class="gradient-text">Face Detection</span></h2>
                <p class="method-subtitle">Use your camera to scan each face of your cube</p>

                <div class="methodology-container">
                    <div class="face-order-guide">
                        <h3 class="method-subtitle">Face Scanning Order</h3>
                        <div class="face-sequence">
                            <div class="face-step">
                                <div class="step-number">1</div>
                                <div class="face-step-content">
                                    <strong>Current Face: <span id="current-face-name">Top Face</span></strong>
                                    <p id="orientation-instructions">Hold the cube with the selected center color facing
                                        up.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="current-face-info">
                        <div class="face-progress">Face <span id="current-face-number">1</span> of 6</div>
                    </div>
                </div>

                <div class="ai-detection-area">
                    <div class="camera-section">
                        <div class="camera-container">
                            <video id="camera-feed" autoplay playsinline></video>
                            <canvas id="detection-canvas"></canvas>
                            <div class="camera-overlay">
                                <div class="detection-frame"></div>
                                <div class="face-label-indicator">Position cube face here</div>
                            </div>
                            <div id="detection-progress-container" class="detection-progress-container hidden">
                                <div class="detection-progress-spinner"></div>
                                <div id="detection-progress-text" class="detection-progress-text">Analyzing colors...
                                </div>
                            </div>
                            <div class="detection-status-indicator" style="display: none;">
                                <div class="status-spinner"></div>
                                <div class="status-text">Processing...</div>
                            </div>
                        </div>
                        <div class="camera-controls">
                            <button id="capture-button" class="cta-button primary">Capture Face</button>
                        </div>
                        <div class="2d-cube-preview" style="display: none;">
                            2d cube preview flash after each capture for confirmation
                        </div>
                    </div>

                    <div class="preview-container">
                        <div class="cube-preview-canvas" id="live-preview">
                            Live preview will appear here
                        </div>
                        <div class="preview-info">
                            <div class="progress-container">
                                <h3 class="method-subtitle">Detection Progress</h3>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 0%"></div>
                                </div>
                                <div class="progress-text">0 of 6 faces detected</div>
                            </div>
                            <div class="confidence-container">
                                <h3 class="method-subtitle">AI Confidence</h3>
                                <div class="confidence-bar">
                                    <div id="confidence-bar" class="confidence-fill" style="width: 0%"></div>
                                </div>
                                <div id="confidence-text" class="confidence-text">0%</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="detection-tips" id="detection-tips">
                    <h4>Detection Tips:</h4>
                    <ul>
                        <li>Ensure good lighting on the cube face</li>
                        <li>Hold the cube steady and center it in the frame</li>
                        <li>Make sure all 9 stickers are clearly visible</li>
                        <li>Avoid shadows and reflections</li>
                    </ul>
                </div>

                <div class="step-actions">
                    <button id="face-detection-back" class="cta-button secondary">Back to Color Selection</button>
                    <button id="face-detection-next" class="cta-button primary" disabled>Next Face</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" style="display: none;">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner-inner"></div>
            </div>
            <h2 class="gradient-text">Solving Your Cube</h2>
            <p id="loading-message">Analyzing cube configuration...</p>
        </div>
    </div>

    <!-- Solution Card -->
    <div id="solution-card" class="solution-card" style="display: none;">
        <div class="solution-header">
            <h2 class="gradient-text">Your Solution</h2>
            <button id="close-solution" class="close-button"><i class="fas fa-times"></i></button>
        </div>
        <div class="solution-content">
            <div class="solution-steps-container">
                <h3 class="method-subtitle">Solution Steps</h3>
                <div id="solution-steps" class="solution-steps"></div>
            </div>
            <div class="solution-actions">
                <button id="restart-button" class="cta-button secondary">Solve Another Cube</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-logo">
                <div class="logo-small">
                    <!-- Small version of the logo -->
                    <svg width="40" height="40" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="10" y="10" width="40" height="40" rx="4" fill="var(--accent-primary)" />
                    </svg>
                </div>
                <div class="footer-brand">
                    <h3 class="footer-brand-name">CubeMaster<span>AI</span></h3>
                </div>
            </div>

            <div class="footer-links">
                <div class="footer-contact">
                    <h4>Contact</h4>
                    <p>Shivansh Rana</p>
                    <p>Computer Science & Engineering Department</p>
                    <p>Delhi Technogical University</p>
                    <p>Email: shivanshrana_23cs400@dtu.ac.in </p>
                </div>

                <div class="footer-social">
                    <h4>Connect</h4>
                    <div class="social-icons">
                        <a href="https://www.linkedin.com/in/shivanshranadtu" target="_blank" class="social-icon"
                            aria-label="LinkedIn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path
                                    d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z">
                                </path>
                                <rect x="2" y="9" width="4" height="12"></rect>
                                <circle cx="4" cy="4" r="2"></circle>
                            </svg>
                        </a>
                        <a href="https://instagram.com/the_realshivansh" target="_blank" class="social-icon"
                            aria-label="Instagram">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025-2026 CubeMasterAI | All rights reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="{{ url_for('static', filename='js/cube_3d.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/palette.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ai_input_interactions.js') }}"></script>
</body>

</html>